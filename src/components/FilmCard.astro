---
import type { Film } from '../scraper/types';

interface Props {
  film: Film;
  isNew?: boolean;
}

const { film, isNew = false } = Astro.props;

function formatDuration(minutes?: number): string {
  if (!minutes) return '';
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  return `${hours}h${mins > 0 ? ` ${mins}min` : ''}`;
}
---

<div class="card hover:shadow-lg transition relative">
  {isNew && (
    <div class="absolute top-2 right-2 bg-primary text-black text-xs font-bold px-2 py-1 rounded z-10">
      NOUVEAU
    </div>
  )}
  
  <div class="flex flex-col md:flex-row gap-4 p-4">
    <!-- Affiche -->
    <div class="flex-shrink-0">
      {film.poster_url ? (
        <img
          src={film.poster_url}
          alt={`Affiche de ${film.title}`}
          class="w-32 h-48 object-cover rounded"
          loading="lazy"
        />
      ) : (
        <div class="w-32 h-48 bg-gray-200 rounded flex items-center justify-center">
          <span class="text-gray-400 text-4xl">ðŸŽ¬</span>
        </div>
      )}
    </div>

    <!-- Infos -->
    <div class="flex-grow">
      <h3 class="text-xl font-bold mb-2">
        <a href={`/film/${film.id}`} class="hover:text-primary transition">
          {film.title}
        </a>
      </h3>

      {film.original_title && film.original_title !== film.title && (
        <p class="text-sm text-gray-600 mb-2 italic">{film.original_title}</p>
      )}

      <div class="flex flex-wrap gap-2 mb-3">
        {film.genres.map((genre) => (
          <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
            {genre}
          </span>
        ))}
      </div>

      <div class="text-sm text-gray-600 space-y-1 mb-3">
        {film.duration_minutes && (
          <p><strong>DurÃ©e:</strong> {formatDuration(film.duration_minutes)}</p>
        )}
        {film.director && (
          <p><strong>RÃ©alisateur:</strong> {film.director}</p>
        )}
        {film.nationality && (
          <p><strong>NationalitÃ©:</strong> {film.nationality}</p>
        )}
        {film.certificate && (
          <p><strong>Classification:</strong> {film.certificate}</p>
        )}
      </div>

      {(film.press_rating || film.audience_rating) && (
        <div class="flex gap-4 mb-3">
          {film.press_rating && (
            <div class="flex items-center gap-1">
              <span class="text-yellow-500">â˜…</span>
              <span class="font-semibold">{film.press_rating.toFixed(1)}</span>
              <span class="text-xs text-gray-500">Presse</span>
            </div>
          )}
          {film.audience_rating && (
            <div class="flex items-center gap-1">
              <span class="text-yellow-500">â˜…</span>
              <span class="font-semibold">{film.audience_rating.toFixed(1)}</span>
              <span class="text-xs text-gray-500">Spectateurs</span>
            </div>
          )}
        </div>
      )}

      {film.synopsis && (
        <p class="text-sm text-gray-700 line-clamp-3">{film.synopsis}</p>
      )}
    </div>
  </div>
</div>
